<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SpeakRight - Pronunciation Trainer</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
    }
    #textInput {
        width: 100%;
        height: 120px;
        font-size: 16px;
    }
    #output {
        font-size: 22px;
        line-height: 40px;
        margin-top: 20px;
        padding: 10px;
        background: #fff;
        border-radius: 10px;
    }
    .word {
        padding: 3px 6px;
        border-radius: 6px;
    }
    .correct {
        background: #b5ffb5;
    }
    .wrong {
        background: #ffb5b5;
    }
    button {
        padding: 12px 20px;
        margin-top: 10px;
        font-size: 18px;
    }
</style>
</head>
<body>

<h2>SpeakRight â€“ Live Pronunciation Checker</h2>

<textarea id="textInput" placeholder="Paste your text here..."></textarea>
<br>
<button onclick="prepareText()">Prepare Text</button>
<button onclick="startReading()">Start Reading</button>
<button onclick="stopReading()">Stop</button>

<div id="output"></div>

<script>
let words = [];
let currentIndex = 0;
let recognition;

function prepareText() {
    const text = document.getElementById("textInput").value.trim();
    if (!text) {
        alert("Paste some text first!");
        return;
    }

    words = text.split(/\s+/);
    currentIndex = 0;

    const output = document.getElementById("output");
    output.innerHTML = "";

    words.forEach((w, i) => {
        const span = document.createElement("span");
        span.className = "word";
        span.id = "word-" + i;
        span.innerText = w + " ";
        output.appendChild(span);
    });
}

function speakCorrect(word) {
    const utter = new SpeechSynthesisUtterance(word);
    utter.rate = 0.9;
    speechSynthesis.speak(utter);
}

function startReading() {
    if (!words.length) {
        alert("Click 'Prepare Text' first!");
        return;
    }

    if (!('webkitSpeechRecognition' in window)) {
        alert("Your browser does not support speech recognition.");
        return;
    }

    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onresult = function(event) {
        const result = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
        const spokenWords = result.split(" ");

        let lastWord = spokenWords[spokenWords.length - 1];

        if (!lastWord) return;

        if (currentIndex >= words.length) return;

        let expected = words[currentIndex].toLowerCase();

        let element = document.getElementById("word-" + currentIndex);

        // Check similarity
        let correct =
            lastWord === expected ||
            lastWord.replace(/[^a-z]/g, "") === expected.replace(/[^a-z]/g, "") ||
            similarity(lastWord, expected) > 0.7;

        if (correct) {
            element.classList.add("correct");
            currentIndex++;
        } else {
            element.classList.add("wrong");
            speakCorrect(expected);
        }
    };

    recognition.start();
}

function stopReading() {
    if (recognition) recognition.stop();
}

// Simple similarity scoring
function similarity(a, b) {
    let longer = a.length > b.length ? a : b;
    let shorter = a.length > b.length ? b : a;
    let longerLength = longer.length;
    if (longerLength === 0) return 1.0;
    return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
}

function editDistance(a, b) {
    a = a.toLowerCase();
    b = b.toLowerCase();
    let costs = [];
    for (let i = 0; i <= a.length; i++) {
        let lastValue = i;
        for (let j = 0; j <= b.length; j++) {
            if (i === 0)
                costs[j] = j;
            else {
                if (j > 0) {
                    let newValue = costs[j - 1];
                    if (a.charAt(i - 1) !== b.charAt(j - 1))
                        newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                    costs[j - 1] = lastValue;
                    lastValue = newValue;
                }
            }
        }
        if (i > 0)
            costs[b.length] = lastValue;
    }
    return costs[b.length];
}
</script>

</body>
</html>
